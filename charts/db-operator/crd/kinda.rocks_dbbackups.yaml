---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.19.0
  name: dbbackups.kinda.rocks
spec:
  group: kinda.rocks
  names:
    kind: DbBackup
    listKind: DbBackupList
    plural: dbbackups
    singular: dbbackup
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - description: If database was backed up.
      jsonPath: .status.backup.success
      name: BackupSuccess
      type: boolean
    - description: If a backup was uploaded to an external storage.
      jsonPath: .status.upload.success
      name: UploadStatus
      type: boolean
    - description: db-operator version of last full reconcile
      jsonPath: .status.operatorVersion
      name: OperatorVersion
      type: string
    - description: time since creation of resource
      jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1beta1
    schema:
      openAPIV3Schema:
        description: DbBackup is the Schema for the dbbackups API
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: spec defines the desired state of DbBackup
            properties:
              database:
                description: A name of a database to back up. Must be in the same
                  namespace
                type: string
              image:
                default:
                  pullPolicy: IfNotPresent
                  registry: ghcr.io
                  repository: db-operator/db-backup-tools
                  tag: latest
                description: Which image should be used
                properties:
                  pullPolicy:
                    default: IfNotPresent
                    description: For example Never
                    type: string
                  registry:
                    default: ghcr.io
                    description: For example docker.io or ghcr.io
                    type: string
                  repository:
                    default: db-operator/db-backup-tools
                    description: For example db-operator/postgresql-backup
                    type: string
                  tag:
                    default: latest
                    description: For example latest
                    type: string
                required:
                - pullPolicy
                - registry
                - repository
                - tag
                type: object
              retries:
                default: 3
                format: int32
                type: integer
            required:
            - database
            - image
            - retries
            type: object
          status:
            description: status defines the observed state of DbBackup
            properties:
              conditions:
                description: |-
                  conditions represent the current state of the DbBackup resource.
                  Each condition has a unique type and reflects the status of a specific aspect of the resource.

                  Standard condition types include:
                  - "Available": the resource is fully functional
                  - "Progressing": the resource is being created or updated
                  - "Degraded": the resource failed to reach or maintain its desired state

                  The status of each condition is one of True, False, or Unknown.
                items:
                  description: Condition contains details for one aspect of the current
                    state of this API Resource.
                  properties:
                    lastTransitionTime:
                      description: |-
                        lastTransitionTime is the last time the condition transitioned from one status to another.
                        This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: |-
                        message is a human readable message indicating details about the transition.
                        This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: |-
                        observedGeneration represents the .metadata.generation that the condition was set based upon.
                        For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                        with respect to the current state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: |-
                        reason contains a programmatic identifier indicating the reason for the condition's last transition.
                        Producers of specific condition types may define expected values and meanings for this field,
                        and whether the values are considered a guaranteed API.
                        The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: type of condition in CamelCase or in foo.example.com/CamelCase.
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
                x-kubernetes-list-map-keys:
                - type
                x-kubernetes-list-type: map
              dumpDuration:
                default: 0
                description: How long did it take to back up the database (in seconds)
                format: int32
                type: integer
              failedRetries:
                default: 0
                description: |-
                  How many retries have already failed
                  Use by the operator to stop retries once .spec.retries amount is reached
                format: int32
                type: integer
              lockedByBackupPod:
                description: |-
                  If true, operaror will not reconcile the object
                  Is needed to allow the backup pod to change the status of the CR
                  without triggering a full reconcile loop again
                type: boolean
              operatorVersion:
                type: string
              size:
                default: 0
                description: The size of the backup (in bytes)
                format: int64
                type: integer
              uploadDuration:
                default: 0
                description: How long did it take to upload a backup (in seconds)
                format: int32
                type: integer
            required:
            - dumpDuration
            - failedRetries
            - lockedByBackupPod
            - size
            - uploadDuration
            type: object
        required:
        - spec
        type: object
    served: true
    storage: true
    subresources:
      status: {}
